{"version":3,"file":"utility-record.js","sources":["pages/utility-record/utility-record.vue","pages/utility-record/utility-record.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 房间信息 -->\r\n    <view class=\"room-header\" v-if=\"roomInfo\">\r\n      <view class=\"room-title\">{{ roomInfo.room_number }}号房 - 水电管理</view>\r\n      <view class=\"current-readings\">\r\n        <view class=\"reading-item\">\r\n          <text class=\"reading-label\">当前电表:</text>\r\n          <text class=\"reading-value\">{{ roomInfo.utilities?.electricity_reading || 0 }}度</text>\r\n        </view>\r\n        <view class=\"reading-item\">\r\n          <text class=\"reading-label\">当前水表:</text>\r\n          <text class=\"reading-value\">{{ roomInfo.utilities?.water_reading || 0 }}吨</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 添加记录按钮 -->\r\n    <view class=\"add-record-btn\" @click=\"showAddForm = true\">\r\n      <text class=\"btn-text\">+ 添加水电记录</text>\r\n    </view>\r\n\r\n    <!-- 记录列表 -->\r\n    <view class=\"record-list\">\r\n      <view class=\"record-item\" v-for=\"record in recordList\" :key=\"record._id\">\r\n        <view class=\"record-header\">\r\n          <view class=\"record-date\">{{ formatDateTime(record.record_date) }}</view>\r\n          <view class=\"record-status\" :class=\"{ paid: record.is_paid }\">\r\n            {{ record.is_paid ? '已缴费' : '未缴费' }}\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"record-details\">\r\n          <view class=\"detail-row\">\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">电表读数:</text>\r\n              <text class=\"detail-value\">{{ record.electricity_reading }}度</text>\r\n            </view>\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">用电量:</text>\r\n              <text class=\"detail-value\">{{ record.electricity_usage }}度</text>\r\n            </view>\r\n          </view>\r\n          \r\n          <view class=\"detail-row\">\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">水表读数:</text>\r\n              <text class=\"detail-value\">{{ record.water_reading }}吨</text>\r\n            </view>\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">用水量:</text>\r\n              <text class=\"detail-value\">{{ record.water_usage }}吨</text>\r\n            </view>\r\n          </view>\r\n          \r\n          <view class=\"detail-row\">\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">电费:</text>\r\n              <text class=\"detail-value fee\">¥{{ record.electricity_fee.toFixed(2) }}</text>\r\n            </view>\r\n            <view class=\"detail-item\">\r\n              <text class=\"detail-label\">水费:</text>\r\n              <text class=\"detail-value fee\">¥{{ record.water_fee.toFixed(2) }}</text>\r\n            </view>\r\n          </view>\r\n          \r\n          <view class=\"total-fee\">\r\n            <text class=\"total-label\">总费用:</text>\r\n            <text class=\"total-value\">¥{{ record.total_fee.toFixed(2) }}</text>\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"record-actions\" v-if=\"!record.is_paid\">\r\n          <button class=\"pay-btn\" @click=\"markAsPaid(record._id)\">标记已缴费</button>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"no-records\" v-if=\"recordList.length === 0 && !loading\">\r\n        <text>暂无水电记录</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 添加记录弹窗 -->\r\n    <view class=\"modal-overlay\" v-if=\"showAddForm\" @click=\"closeAddForm\">\r\n      <view class=\"modal-content\" @click.stop>\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">添加水电记录</text>\r\n          <text class=\"modal-close\" @click=\"closeAddForm\">×</text>\r\n        </view>\r\n        \r\n        <view class=\"form-content\">\r\n          <view class=\"form-item\">\r\n            <view class=\"form-label\">电表读数(度)</view>\r\n            <input \r\n              class=\"form-input\"\r\n              v-model.number=\"newRecord.electricity_reading\"\r\n              type=\"digit\"\r\n              placeholder=\"请输入当前电表读数\"\r\n            />\r\n          </view>\r\n          \r\n          <view class=\"form-item\">\r\n            <view class=\"form-label\">水表读数(吨)</view>\r\n            <input \r\n              class=\"form-input\"\r\n              v-model.number=\"newRecord.water_reading\"\r\n              type=\"digit\"\r\n              placeholder=\"请输入当前水表读数\"\r\n            />\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"modal-actions\">\r\n          <button class=\"modal-btn cancel\" @click=\"closeAddForm\">取消</button>\r\n          <button class=\"modal-btn confirm\" @click=\"addRecord\">确定</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 加载状态 -->\r\n    <view class=\"loading\" v-if=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      roomId: '',\r\n      roomInfo: null,\r\n      recordList: [],\r\n      loading: true,\r\n      showAddForm: false,\r\n      newRecord: {\r\n        electricity_reading: '',\r\n        water_reading: ''\r\n      }\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    if (options.roomId) {\r\n      this.roomId = options.roomId;\r\n      this.loadRoomInfo();\r\n      this.loadRecords();\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    // 加载房间信息\r\n    async loadRoomInfo() {\r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRoomById',\r\n            data: { id: this.roomId }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          this.roomInfo = result.result.data;\r\n        }\r\n      } catch (error) {\r\n        console.error('加载房间信息失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 加载水电记录\r\n    async loadRecords() {\r\n      this.loading = true;\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getUtilityRecords',\r\n            data: {\r\n              roomId: this.roomId,\r\n              pageSize: 50,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          this.recordList = result.result.data.list;\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('加载水电记录失败:', error);\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    \r\n    // 添加水电记录\r\n    async addRecord() {\r\n      if (!this.newRecord.electricity_reading && !this.newRecord.water_reading) {\r\n        uni.showToast({\r\n          title: '请输入电表或水表读数',\r\n          icon: 'none'\r\n        });\r\n        return;\r\n      }\r\n      \r\n      uni.showLoading({\r\n        title: '添加中...'\r\n      });\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'addUtilityRecord',\r\n            data: {\r\n              roomId: this.roomId,\r\n              electricity_reading: this.newRecord.electricity_reading || 0,\r\n              water_reading: this.newRecord.water_reading || 0\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          uni.showToast({\r\n            title: '添加成功',\r\n            icon: 'success'\r\n          });\r\n          \r\n          this.closeAddForm();\r\n          this.loadRecords();\r\n          this.loadRoomInfo(); // 更新房间信息中的读数\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('添加水电记录失败:', error);\r\n        uni.showToast({\r\n          title: '添加失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        uni.hideLoading();\r\n      }\r\n    },\r\n    \r\n    // 标记已缴费\r\n    async markAsPaid(recordId) {\r\n      uni.showModal({\r\n        title: '确认操作',\r\n        content: '确定要标记为已缴费吗？',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              const result = await uniCloud.callFunction({\r\n                name: 'room-management',\r\n                data: {\r\n                  action: 'updateUtilityPayment',\r\n                  data: {\r\n                    recordId,\r\n                    isPaid: true\r\n                  }\r\n                }\r\n              });\r\n              \r\n              if (result.result.code === 0) {\r\n                uni.showToast({\r\n                  title: '更新成功',\r\n                  icon: 'success'\r\n                });\r\n                this.loadRecords();\r\n              } else {\r\n                uni.showToast({\r\n                  title: result.result.message,\r\n                  icon: 'none'\r\n                });\r\n              }\r\n            } catch (error) {\r\n              console.error('更新缴费状态失败:', error);\r\n              uni.showToast({\r\n                title: '操作失败',\r\n                icon: 'none'\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    \r\n    // 关闭添加表单\r\n    closeAddForm() {\r\n      this.showAddForm = false;\r\n      this.newRecord = {\r\n        electricity_reading: '',\r\n        water_reading: ''\r\n      };\r\n    },\r\n    \r\n    // 格式化日期时间\r\n    formatDateTime(timestamp) {\r\n      const date = new Date(timestamp);\r\n      return date.toLocaleString();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.room-header {\r\n  background-color: #fff;\r\n  padding: 40rpx;\r\n  border-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.room-title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.current-readings {\r\n  display: flex;\r\n  gap: 40rpx;\r\n}\r\n\r\n.reading-item {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.reading-label {\r\n  color: #666;\r\n  font-size: 28rpx;\r\n  margin-right: 8rpx;\r\n}\r\n\r\n.reading-value {\r\n  color: #007AFF;\r\n  font-size: 28rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.add-record-btn {\r\n  margin: 20rpx;\r\n  padding: 32rpx;\r\n  background-color: #007AFF;\r\n  color: white;\r\n  text-align: center;\r\n  border-radius: 16rpx;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.record-list {\r\n  padding: 0 20rpx 20rpx;\r\n}\r\n\r\n.record-item {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 32rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.record-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.record-date {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  font-weight: bold;\r\n}\r\n\r\n.record-status {\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 20rpx;\r\n  font-size: 24rpx;\r\n  background-color: #ff4d4f;\r\n  color: white;\r\n}\r\n\r\n.record-status.paid {\r\n  background-color: #52c41a;\r\n}\r\n\r\n.record-details {\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.detail-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.detail-item {\r\n  display: flex;\r\n  align-items: center;\r\n  flex: 1;\r\n}\r\n\r\n.detail-label {\r\n  color: #666;\r\n  font-size: 26rpx;\r\n  margin-right: 8rpx;\r\n}\r\n\r\n.detail-value {\r\n  color: #333;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.fee {\r\n  color: #ff4d4f;\r\n  font-weight: bold;\r\n}\r\n\r\n.total-fee {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  padding-top: 16rpx;\r\n  border-top: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.total-label {\r\n  color: #333;\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  margin-right: 12rpx;\r\n}\r\n\r\n.total-value {\r\n  color: #ff4d4f;\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.record-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n}\r\n\r\n.pay-btn {\r\n  padding: 16rpx 32rpx;\r\n  background-color: #52c41a;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 8rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.no-records {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0,0,0,0.5);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.modal-content {\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  width: 600rpx;\r\n  max-height: 80vh;\r\n}\r\n\r\n.modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 40rpx 40rpx 20rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.modal-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.modal-close {\r\n  font-size: 48rpx;\r\n  color: #999;\r\n  line-height: 1;\r\n}\r\n\r\n.form-content {\r\n  padding: 40rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.form-label {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  padding: 20rpx;\r\n  border: 2rpx solid #e8e8e8;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.modal-actions {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 20rpx 40rpx 40rpx;\r\n}\r\n\r\n.modal-btn {\r\n  flex: 1;\r\n  padding: 24rpx;\r\n  border: none;\r\n  border-radius: 12rpx;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.cancel {\r\n  background-color: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.confirm {\r\n  background-color: #007AFF;\r\n  color: white;\r\n}\r\n\r\n.loading {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 400rpx;\r\n  color: #999;\r\n}\r\n</style>","import MiniProgramPage from '/Users/peakom/Documents/room-list/pages/utility-record/utility-record.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}