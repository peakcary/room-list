{"version":3,"file":"test.js","sources":["pages/test/test.vue","pages/test/test.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">系统初始化测试</text>\r\n    </view>\r\n    \r\n    <view class=\"test-section\">\r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"initDatabase\">初始化数据库</button>\r\n        <text class=\"test-result\">{{ dbInitResult }}</text>\r\n      </view>\r\n      \r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"testRoomManagement\">测试房间管理接口</button>\r\n        <text class=\"test-result\">{{ roomTestResult }}</text>\r\n      </view>\r\n      \r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"addTestRoom\">添加测试房间</button>\r\n        <text class=\"test-result\">{{ addRoomResult }}</text>\r\n      </view>\r\n      \r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"getRooms\">获取全部房间列表</button>\r\n        <text class=\"test-result\">{{ getRoomsResult }}</text>\r\n      </view>\r\n      \r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"getAvailableRooms\">获取可租用房间</button>\r\n        <text class=\"test-result\">{{ availableRoomsResult }}</text>\r\n      </view>\r\n      \r\n      <view class=\"test-item\">\r\n        <button class=\"test-btn\" @click=\"getRentedRooms\">获取已租用房间</button>\r\n        <text class=\"test-result\">{{ rentedRoomsResult }}</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"debug-info\">\r\n      <text class=\"debug-title\">调试信息：</text>\r\n      <text class=\"debug-text\">{{ debugInfo }}</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      dbInitResult: '',\r\n      roomTestResult: '',\r\n      addRoomResult: '',\r\n      getRoomsResult: '',\r\n      availableRoomsResult: '',\r\n      rentedRoomsResult: '',\r\n      debugInfo: '等待测试...'\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    // 初始化数据库\r\n    async initDatabase() {\r\n      this.dbInitResult = '初始化中...';\r\n      this.debugInfo = '正在初始化数据库...';\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'db-init',\r\n          data: {}\r\n        });\r\n        \r\n        this.dbInitResult = `初始化完成: ${result.result.message}`;\r\n        this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        \r\n      } catch (error) {\r\n        this.dbInitResult = `初始化失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('数据库初始化失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 测试房间管理接口\r\n    async testRoomManagement() {\r\n      this.roomTestResult = '测试中...';\r\n      this.debugInfo = '正在测试房间管理接口...';\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              pageSize: 10,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        this.roomTestResult = `测试成功: 找到 ${result.result.data?.total || 0} 个房间`;\r\n        this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        \r\n      } catch (error) {\r\n        this.roomTestResult = `测试失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('房间管理接口测试失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 添加测试房间\r\n    async addTestRoom() {\r\n      this.addRoomResult = '添加中...';\r\n      this.debugInfo = '正在添加测试房间...';\r\n      \r\n      try {\r\n        const testRoom = {\r\n          room_number: `TEST${Date.now()}`,\r\n          floor: 1,\r\n          area: 25,\r\n          rent_price: 1000,\r\n          status: 'available',\r\n          utilities: {\r\n            electricity_reading: 0,\r\n            water_reading: 0,\r\n            electricity_rate: 0.5,\r\n            water_rate: 3.0\r\n          }\r\n        };\r\n        \r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'addRoom',\r\n            data: testRoom\r\n          }\r\n        });\r\n        \r\n        this.addRoomResult = `添加成功: 房间号 ${testRoom.room_number}`;\r\n        this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        \r\n      } catch (error) {\r\n        this.addRoomResult = `添加失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('添加测试房间失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 获取房间列表\r\n    async getRooms() {\r\n      this.getRoomsResult = '获取中...';\r\n      this.debugInfo = '正在获取房间列表...';\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              pageSize: 10,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          const rooms = result.result.data.list;\r\n          this.getRoomsResult = `获取成功: 共 ${result.result.data.total} 个房间`;\r\n          this.debugInfo = `房间列表: ${rooms.map(r => r.room_number).join(', ')}`;\r\n        } else {\r\n          this.getRoomsResult = `获取失败: ${result.result.message}`;\r\n          this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        }\r\n        \r\n      } catch (error) {\r\n        this.getRoomsResult = `获取失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('获取房间列表失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 获取可租用房间\r\n    async getAvailableRooms() {\r\n      this.availableRoomsResult = '获取中...';\r\n      this.debugInfo = '正在获取可租用房间...';\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              status: 'available',\r\n              pageSize: 10,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          const rooms = result.result.data.list;\r\n          this.availableRoomsResult = `获取成功: 共 ${result.result.data.total} 个可租用房间`;\r\n          this.debugInfo = `可租用房间: ${rooms.map(r => r.room_number).join(', ')}`;\r\n        } else {\r\n          this.availableRoomsResult = `获取失败: ${result.result.message}`;\r\n          this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        }\r\n        \r\n      } catch (error) {\r\n        this.availableRoomsResult = `获取失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('获取可租用房间失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 获取已租用房间\r\n    async getRentedRooms() {\r\n      this.rentedRoomsResult = '获取中...';\r\n      this.debugInfo = '正在获取已租用房间...';\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              status: 'rented',\r\n              pageSize: 10,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          const rooms = result.result.data.list;\r\n          this.rentedRoomsResult = `获取成功: 共 ${result.result.data.total} 个已租用房间`;\r\n          this.debugInfo = `已租用房间: ${rooms.map(r => r.room_number + (r.current_tenant ? ` (${r.current_tenant.name})` : '')).join(', ')}`;\r\n        } else {\r\n          this.rentedRoomsResult = `获取失败: ${result.result.message}`;\r\n          this.debugInfo = JSON.stringify(result.result, null, 2);\r\n        }\r\n        \r\n      } catch (error) {\r\n        this.rentedRoomsResult = `获取失败: ${error.message}`;\r\n        this.debugInfo = `Error: ${JSON.stringify(error, null, 2)}`;\r\n        console.error('获取已租用房间失败:', error);\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  padding: 40rpx;\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 60rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 48rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.test-section {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 40rpx;\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.test-item {\r\n  margin-bottom: 40rpx;\r\n  padding-bottom: 30rpx;\r\n  border-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.test-item:last-child {\r\n  margin-bottom: 0;\r\n  border-bottom: none;\r\n}\r\n\r\n.test-btn {\r\n  width: 100%;\r\n  padding: 30rpx;\r\n  background-color: #007AFF;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 12rpx;\r\n  font-size: 32rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.test-result {\r\n  display: block;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  word-break: break-all;\r\n}\r\n\r\n.debug-info {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 40rpx;\r\n}\r\n\r\n.debug-title {\r\n  display: block;\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.debug-text {\r\n  display: block;\r\n  font-size: 24rpx;\r\n  color: #666;\r\n  white-space: pre-wrap;\r\n  word-break: break-all;\r\n  line-height: 1.5;\r\n}\r\n</style>","import MiniProgramPage from '/Users/peakom/Documents/work/room-list/pages/test/test.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}