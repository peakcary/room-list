{"version":3,"file":"index.js","sources":["pages/index/index.vue","pages/index/index.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 欢迎区域 -->\r\n    <view class=\"welcome-section\">\r\n      <view class=\"welcome-title\">房间管理系统</view>\r\n      <view class=\"welcome-subtitle\">高效管理您的房产资源</view>\r\n    </view>\r\n\r\n    <!-- 统计卡片 -->\r\n    <view class=\"stats-grid\">\r\n      <view class=\"stat-card\" @click=\"navigateToRooms('')\">\r\n        <view class=\"stat-icon total\">🏠</view>\r\n        <view class=\"stat-number\">{{ statistics.total }}</view>\r\n        <view class=\"stat-label\">总房间数</view>\r\n      </view>\r\n      \r\n      <view class=\"stat-card\" @click=\"navigateToRooms('rented')\">\r\n        <view class=\"stat-icon rented\">🔑</view>\r\n        <view class=\"stat-number\">{{ statistics.rented }}</view>\r\n        <view class=\"stat-label\">已出租</view>\r\n      </view>\r\n      \r\n      <view class=\"stat-card\" @click=\"navigateToRooms('available')\">\r\n        <view class=\"stat-icon available\">🆓</view>\r\n        <view class=\"stat-number\">{{ statistics.available }}</view>\r\n        <view class=\"stat-label\">空闲房间</view>\r\n      </view>\r\n      \r\n      <view class=\"stat-card\">\r\n        <view class=\"stat-icon revenue\">💰</view>\r\n        <view class=\"stat-number\">{{ statistics.monthlyRevenue }}</view>\r\n        <view class=\"stat-label\">月收入(元)</view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 快捷操作 -->\r\n    <view class=\"quick-actions\">\r\n      <view class=\"section-title\">快捷操作</view>\r\n      <view class=\"action-grid\">\r\n        <view class=\"action-item\" @click=\"addRoom\">\r\n          <view class=\"action-icon\">➕</view>\r\n          <text class=\"action-text\">添加房间</text>\r\n        </view>\r\n        \r\n        <view class=\"action-item\" @click=\"viewRooms\">\r\n          <view class=\"action-icon\">📋</view>\r\n          <text class=\"action-text\">房间列表</text>\r\n        </view>\r\n        \r\n        <view class=\"action-item\" @click=\"utilityRecords\">\r\n          <view class=\"action-icon\">⚡</view>\r\n          <text class=\"action-text\">水电管理</text>\r\n        </view>\r\n        \r\n        <view class=\"action-item\" @click=\"tenantManagement\">\r\n          <view class=\"action-icon\">👥</view>\r\n          <text class=\"action-text\">租户管理</text>\r\n        </view>\r\n        \r\n        <view class=\"action-item debug-item\" @click=\"systemTest\">\r\n          <view class=\"action-icon\">🔧</view>\r\n          <text class=\"action-text\">系统测试</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 最近活动 -->\r\n    <view class=\"recent-activity\">\r\n      <view class=\"section-title\">最近活动</view>\r\n      <view class=\"activity-list\">\r\n        <view class=\"activity-item\" v-for=\"activity in recentActivities\" :key=\"activity.id\">\r\n          <view class=\"activity-icon\">{{ activity.icon }}</view>\r\n          <view class=\"activity-content\">\r\n            <view class=\"activity-title\">{{ activity.title }}</view>\r\n            <view class=\"activity-time\">{{ formatTime(activity.time) }}</view>\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"no-activity\" v-if=\"recentActivities.length === 0\">\r\n          <text>暂无最近活动</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      statistics: {\r\n        total: 0,\r\n        rented: 0,\r\n        available: 0,\r\n        monthlyRevenue: 0\r\n      },\r\n      recentActivities: []\r\n    }\r\n  },\r\n  \r\n  onLoad() {\r\n    this.loadStatistics();\r\n    this.loadRecentActivities();\r\n  },\r\n  \r\n  onShow() {\r\n    // 页面显示时刷新数据\r\n    this.loadStatistics();\r\n  },\r\n  \r\n  methods: {\r\n    // 加载统计数据\r\n    async loadStatistics() {\r\n      try {\r\n        // 获取房间统计\r\n        const promises = [\r\n          this.getRoomCount(''),\r\n          this.getRoomCount('rented'),\r\n          this.getRoomCount('available')\r\n        ];\r\n        \r\n        const results = await Promise.all(promises);\r\n        \r\n        this.statistics.total = results[0];\r\n        this.statistics.rented = results[1];\r\n        this.statistics.available = results[2];\r\n        \r\n        // 计算月收入（获取已租房间的租金总和）\r\n        await this.calculateMonthlyRevenue();\r\n        \r\n      } catch (error) {\r\n        console.error('加载统计数据失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 获取房间数量\r\n    async getRoomCount(status) {\r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              status,\r\n              pageSize: 1000, // 获取所有数据来计算总数\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        return result.result.code === 0 ? result.result.data.total : 0;\r\n      } catch (error) {\r\n        console.error('获取房间数量失败:', error);\r\n        return 0;\r\n      }\r\n    },\r\n    \r\n    // 计算月收入\r\n    async calculateMonthlyRevenue() {\r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRooms',\r\n            data: {\r\n              status: 'rented',\r\n              pageSize: 1000,\r\n              pageNum: 1\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          const rentedRooms = result.result.data.list;\r\n          const totalRevenue = rentedRooms.reduce((sum, room) => {\r\n            return sum + (room.rent_price || 0);\r\n          }, 0);\r\n          \r\n          this.statistics.monthlyRevenue = totalRevenue;\r\n        }\r\n      } catch (error) {\r\n        console.error('计算月收入失败:', error);\r\n      }\r\n    },\r\n    \r\n    // 加载最近活动\r\n    loadRecentActivities() {\r\n      // 这里可以从数据库加载最近的操作记录\r\n      // 暂时使用模拟数据\r\n      this.recentActivities = [\r\n        {\r\n          id: 1,\r\n          icon: '🏠',\r\n          title: '新增了101号房间',\r\n          time: new Date(Date.now() - 2 * 60 * 60 * 1000) // 2小时前\r\n        }\r\n      ];\r\n    },\r\n    \r\n    // 导航到房间列表\r\n    navigateToRooms(status) {\r\n      uni.switchTab({\r\n        url: '/pages/room-list/room-list'\r\n      });\r\n    },\r\n    \r\n    // 添加房间\r\n    addRoom() {\r\n      uni.navigateTo({\r\n        url: '/pages/room-edit/room-edit'\r\n      });\r\n    },\r\n    \r\n    // 查看房间列表\r\n    viewRooms() {\r\n      uni.switchTab({\r\n        url: '/pages/room-list/room-list'\r\n      });\r\n    },\r\n    \r\n    // 水电管理\r\n    utilityRecords() {\r\n      uni.navigateTo({\r\n        url: '/pages/utility-record/utility-record'\r\n      });\r\n    },\r\n    \r\n    // 租户管理\r\n    tenantManagement() {\r\n      uni.navigateTo({\r\n        url: '/pages/tenant-info/tenant-info'\r\n      });\r\n    },\r\n    \r\n    // 系统测试\r\n    systemTest() {\r\n      uni.navigateTo({\r\n        url: '/pages/test/test'\r\n      });\r\n    },\r\n    \r\n    // 格式化时间\r\n    formatTime(time) {\r\n      const now = new Date();\r\n      const diff = now - time;\r\n      const hours = Math.floor(diff / (1000 * 60 * 60));\r\n      \r\n      if (hours < 1) {\r\n        return '刚刚';\r\n      } else if (hours < 24) {\r\n        return `${hours}小时前`;\r\n      } else {\r\n        const days = Math.floor(hours / 24);\r\n        return `${days}天前`;\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  min-height: 100vh;\r\n  padding-bottom: 120rpx;\r\n  /* #ifdef H5 */\r\n  padding-bottom: 70px;\r\n  /* #endif */\r\n}\r\n\r\n.welcome-section {\r\n  padding: 80rpx 40rpx 60rpx;\r\n  text-align: center;\r\n  color: white;\r\n}\r\n\r\n.welcome-title {\r\n  font-size: 48rpx;\r\n  font-weight: bold;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.welcome-subtitle {\r\n  font-size: 28rpx;\r\n  opacity: 0.8;\r\n}\r\n\r\n.stats-grid {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 20rpx;\r\n  padding: 0 40rpx 40rpx;\r\n}\r\n\r\n.stat-card {\r\n  background: white;\r\n  border-radius: 20rpx;\r\n  padding: 40rpx 30rpx;\r\n  text-align: center;\r\n  box-shadow: 0 8rpx 25rpx rgba(0,0,0,0.1);\r\n}\r\n\r\n.stat-icon {\r\n  font-size: 48rpx;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.stat-number {\r\n  font-size: 40rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 8rpx;\r\n}\r\n\r\n.stat-label {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n}\r\n\r\n.quick-actions, .recent-activity {\r\n  background: white;\r\n  margin: 0 40rpx 30rpx;\r\n  border-radius: 20rpx;\r\n  padding: 40rpx 30rpx;\r\n  box-shadow: 0 8rpx 25rpx rgba(0,0,0,0.1);\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.action-grid {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 30rpx;\r\n}\r\n\r\n.debug-item {\r\n  grid-column: 1 / -1;\r\n  background: #ff9500 !important;\r\n}\r\n\r\n.action-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 30rpx 20rpx;\r\n  border-radius: 16rpx;\r\n  background: #f8f9fa;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.action-item:active {\r\n  transform: scale(0.95);\r\n  background: #e9ecef;\r\n}\r\n\r\n.action-icon {\r\n  font-size: 40rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.action-text {\r\n  font-size: 26rpx;\r\n  color: #333;\r\n}\r\n\r\n.activity-list {\r\n  max-height: 400rpx;\r\n}\r\n\r\n.activity-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.activity-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.activity-icon {\r\n  font-size: 32rpx;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.activity-content {\r\n  flex: 1;\r\n}\r\n\r\n.activity-title {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  margin-bottom: 8rpx;\r\n}\r\n\r\n.activity-time {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.no-activity {\r\n  text-align: center;\r\n  padding: 60rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/peakom/Documents/work/room-list/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAuFA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,YAAY;AAAA,QACV,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,WAAW;AAAA,QACX,gBAAgB;AAAA,MACjB;AAAA,MACD,kBAAkB,CAAC;AAAA,IACrB;AAAA,EACD;AAAA,EAED,SAAS;AACP,SAAK,eAAc;AACnB,SAAK,qBAAoB;AAAA,EAC1B;AAAA,EAED,SAAS;AAEP,SAAK,eAAc;AAAA,EACpB;AAAA,EAED,SAAS;AAAA;AAAA,IAEP,MAAM,iBAAiB;AACrB,UAAI;AAEF,cAAM,WAAW;AAAA,UACf,KAAK,aAAa,EAAE;AAAA,UACpB,KAAK,aAAa,QAAQ;AAAA,UAC1B,KAAK,aAAa,WAAW;AAAA;AAG/B,cAAM,UAAU,MAAM,QAAQ,IAAI,QAAQ;AAE1C,aAAK,WAAW,QAAQ,QAAQ,CAAC;AACjC,aAAK,WAAW,SAAS,QAAQ,CAAC;AAClC,aAAK,WAAW,YAAY,QAAQ,CAAC;AAGrC,cAAM,KAAK;MAEX,SAAO,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,gCAAc,aAAa,KAAK;AAAA,MAClC;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,aAAa,QAAQ;AACzB,UAAI;AACF,cAAM,SAAS,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACzC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,MAAM;AAAA,cACJ;AAAA,cACA,UAAU;AAAA;AAAA,cACV,SAAS;AAAA,YACX;AAAA,UACF;AAAA,QACF,CAAC;AAED,eAAO,OAAO,OAAO,SAAS,IAAI,OAAO,OAAO,KAAK,QAAQ;AAAA,MAC7D,SAAO,OAAO;AACdD,sBAAA,MAAA,MAAA,SAAA,gCAAc,aAAa,KAAK;AAChC,eAAO;AAAA,MACT;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,0BAA0B;AAC9B,UAAI;AACF,cAAM,SAAS,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACzC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,MAAM;AAAA,cACJ,QAAQ;AAAA,cACR,UAAU;AAAA,cACV,SAAS;AAAA,YACX;AAAA,UACF;AAAA,QACF,CAAC;AAED,YAAI,OAAO,OAAO,SAAS,GAAG;AAC5B,gBAAM,cAAc,OAAO,OAAO,KAAK;AACvC,gBAAM,eAAe,YAAY,OAAO,CAAC,KAAK,SAAS;AACrD,mBAAO,OAAO,KAAK,cAAc;AAAA,UAClC,GAAE,CAAC;AAEJ,eAAK,WAAW,iBAAiB;AAAA,QACnC;AAAA,MACA,SAAO,OAAO;AACdD,sBAAc,MAAA,MAAA,SAAA,gCAAA,YAAY,KAAK;AAAA,MACjC;AAAA,IACD;AAAA;AAAA,IAGD,uBAAuB;AAGrB,WAAK,mBAAmB;AAAA,QACtB;AAAA,UACE,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,GAAI;AAAA;AAAA,QAChD;AAAA;IAEH;AAAA;AAAA,IAGD,gBAAgB,QAAQ;AACtBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,UAAU;AACRA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,YAAY;AACVA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,iBAAiB;AACfA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,mBAAmB;AACjBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,aAAa;AACXA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,WAAW,MAAM;AACf,YAAM,MAAM,oBAAI;AAChB,YAAM,OAAO,MAAM;AACnB,YAAM,QAAQ,KAAK,MAAM,QAAQ,MAAO,KAAK,GAAG;AAEhD,UAAI,QAAQ,GAAG;AACb,eAAO;AAAA,MACT,WAAW,QAAQ,IAAI;AACrB,eAAO,GAAG,KAAK;AAAA,aACV;AACL,cAAM,OAAO,KAAK,MAAM,QAAQ,EAAE;AAClC,eAAO,GAAG,IAAI;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;AChQA,GAAG,WAAW,eAAe;"}