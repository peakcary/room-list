{"version":3,"file":"room-edit.js","sources":["pages/room-edit/room-edit.vue","pages/room-edit/room-edit.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <form @submit=\"saveRoom\">\r\n      <!-- 基本信息 -->\r\n      <view class=\"form-section\">\r\n        <view class=\"section-title\">基本信息</view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">房间号 *</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model=\"formData.room_number\"\r\n            placeholder=\"请输入房间号\"\r\n            :disabled=\"isEdit\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">楼层</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.floor\"\r\n            type=\"number\"\r\n            placeholder=\"请输入楼层\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">面积(㎡)</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.area\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入面积\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">租金(元/月) *</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.rent_price\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入租金\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">房间状态</view>\r\n          <picker @change=\"onStatusChange\" :value=\"statusIndex\" :range=\"statusOptions\" range-key=\"text\">\r\n            <view class=\"picker-input\">\r\n              {{ statusOptions[statusIndex].text }}\r\n              <text class=\"arrow\">▼</text>\r\n            </view>\r\n          </picker>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 水电设置 -->\r\n      <view class=\"form-section\">\r\n        <view class=\"section-title\">水电设置</view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">当前电表读数(度)</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.utilities.electricity_reading\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入电表读数\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">当前水表读数(吨)</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.utilities.water_reading\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入水表读数\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">电费单价(元/度)</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.utilities.electricity_rate\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入电费单价\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">水费单价(元/吨)</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model.number=\"formData.utilities.water_rate\"\r\n            type=\"digit\"\r\n            placeholder=\"请输入水费单价\"\r\n          />\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 操作按钮 -->\r\n      <view class=\"form-actions\">\r\n        <button class=\"btn-cancel\" @click=\"cancel\">取消</button>\r\n        <button class=\"btn-save\" @click=\"saveRoom\">保存</button>\r\n      </view>\r\n    </form>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      isEdit: false,\r\n      roomId: '',\r\n      formData: {\r\n        room_number: '',\r\n        floor: '',\r\n        area: '',\r\n        rent_price: '',\r\n        status: 'available',\r\n        utilities: {\r\n          electricity_reading: 0,\r\n          water_reading: 0,\r\n          electricity_rate: 0.5,\r\n          water_rate: 3.0\r\n        }\r\n      },\r\n      statusIndex: 0,\r\n      statusOptions: [\r\n        { value: 'available', text: '可租用' },\r\n        { value: 'rented', text: '已租用' },\r\n        { value: 'maintenance', text: '维修中' }\r\n      ]\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    if (options.id) {\r\n      this.isEdit = true;\r\n      this.roomId = options.id;\r\n      this.loadRoomInfo();\r\n      uni.setNavigationBarTitle({\r\n        title: '编辑房间'\r\n      });\r\n    } else {\r\n      uni.setNavigationBarTitle({\r\n        title: '添加房间'\r\n      });\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    // 加载房间信息（编辑时）\r\n    async loadRoomInfo() {\r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRoomById',\r\n            data: { id: this.roomId }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          const roomData = result.result.data;\r\n          this.formData = {\r\n            room_number: roomData.room_number,\r\n            floor: roomData.floor || '',\r\n            area: roomData.area || '',\r\n            rent_price: roomData.rent_price,\r\n            status: roomData.status,\r\n            utilities: {\r\n              electricity_reading: roomData.utilities?.electricity_reading || 0,\r\n              water_reading: roomData.utilities?.water_reading || 0,\r\n              electricity_rate: roomData.utilities?.electricity_rate || 0.5,\r\n              water_rate: roomData.utilities?.water_rate || 3.0\r\n            }\r\n          };\r\n          \r\n          // 设置状态选择器\r\n          this.statusIndex = this.statusOptions.findIndex(option => option.value === roomData.status);\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('加载房间信息失败:', error);\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    \r\n    // 状态选择\r\n    onStatusChange(e) {\r\n      this.statusIndex = e.detail.value;\r\n      this.formData.status = this.statusOptions[this.statusIndex].value;\r\n    },\r\n    \r\n    // 表单验证\r\n    validateForm() {\r\n      if (!this.formData.room_number.trim()) {\r\n        uni.showToast({\r\n          title: '请输入房间号',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      if (!this.formData.rent_price || this.formData.rent_price <= 0) {\r\n        uni.showToast({\r\n          title: '请输入有效的租金',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    },\r\n    \r\n    // 保存房间\r\n    async saveRoom() {\r\n      if (!this.validateForm()) return;\r\n      \r\n      uni.showLoading({\r\n        title: '保存中...'\r\n      });\r\n      \r\n      try {\r\n        const action = this.isEdit ? 'updateRoom' : 'addRoom';\r\n        const data = this.isEdit \r\n          ? { id: this.roomId, ...this.formData }\r\n          : this.formData;\r\n        \r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action,\r\n            data\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          uni.showToast({\r\n            title: this.isEdit ? '更新成功' : '添加成功',\r\n            icon: 'success'\r\n          });\r\n          \r\n          setTimeout(() => {\r\n            uni.navigateBack();\r\n          }, 1500);\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('保存房间失败:', error);\r\n        uni.showToast({\r\n          title: '保存失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        uni.hideLoading();\r\n      }\r\n    },\r\n    \r\n    // 取消\r\n    cancel() {\r\n      uni.navigateBack();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n  padding: 20rpx;\r\n}\r\n\r\n.form-section {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 40rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.form-label {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  padding: 20rpx;\r\n  border: 2rpx solid #e8e8e8;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.form-input:focus {\r\n  border-color: #007AFF;\r\n}\r\n\r\n.form-input[disabled] {\r\n  background-color: #f5f5f5;\r\n  color: #999;\r\n}\r\n\r\n.picker-input {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx;\r\n  border: 2rpx solid #e8e8e8;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.arrow {\r\n  color: #999;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 40rpx 20rpx;\r\n}\r\n\r\n.btn-cancel, .btn-save {\r\n  flex: 1;\r\n  padding: 28rpx;\r\n  border: none;\r\n  border-radius: 12rpx;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.btn-cancel {\r\n  background-color: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.btn-save {\r\n  background-color: #007AFF;\r\n  color: white;\r\n}\r\n</style>","import MiniProgramPage from '/Users/peakom/Documents/work/room-list/pages/room-edit/room-edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAiHA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,UAAU;AAAA,QACR,aAAa;AAAA,QACb,OAAO;AAAA,QACP,MAAM;AAAA,QACN,YAAY;AAAA,QACZ,QAAQ;AAAA,QACR,WAAW;AAAA,UACT,qBAAqB;AAAA,UACrB,eAAe;AAAA,UACf,kBAAkB;AAAA,UAClB,YAAY;AAAA,QACd;AAAA,MACD;AAAA,MACD,aAAa;AAAA,MACb,eAAe;AAAA,QACb,EAAE,OAAO,aAAa,MAAM,MAAO;AAAA,QACnC,EAAE,OAAO,UAAU,MAAM,MAAO;AAAA,QAChC,EAAE,OAAO,eAAe,MAAM,MAAM;AAAA,MACtC;AAAA,IACF;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AACd,QAAI,QAAQ,IAAI;AACd,WAAK,SAAS;AACd,WAAK,SAAS,QAAQ;AACtB,WAAK,aAAY;AACjBA,oBAAAA,MAAI,sBAAsB;AAAA,QACxB,OAAO;AAAA,MACT,CAAC;AAAA,WACI;AACLA,oBAAAA,MAAI,sBAAsB;AAAA,QACxB,OAAO;AAAA,MACT,CAAC;AAAA,IACH;AAAA,EACD;AAAA,EAED,SAAS;AAAA;AAAA,IAEP,MAAM,eAAe;;AACnB,UAAI;AACF,cAAM,SAAS,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACzC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,MAAM,EAAE,IAAI,KAAK,OAAO;AAAA,UAC1B;AAAA,QACF,CAAC;AAED,YAAI,OAAO,OAAO,SAAS,GAAG;AAC5B,gBAAM,WAAW,OAAO,OAAO;AAC/B,eAAK,WAAW;AAAA,YACd,aAAa,SAAS;AAAA,YACtB,OAAO,SAAS,SAAS;AAAA,YACzB,MAAM,SAAS,QAAQ;AAAA,YACvB,YAAY,SAAS;AAAA,YACrB,QAAQ,SAAS;AAAA,YACjB,WAAW;AAAA,cACT,uBAAqB,cAAS,cAAT,mBAAoB,wBAAuB;AAAA,cAChE,iBAAe,cAAS,cAAT,mBAAoB,kBAAiB;AAAA,cACpD,oBAAkB,cAAS,cAAT,mBAAoB,qBAAoB;AAAA,cAC1D,cAAY,cAAS,cAAT,mBAAoB,eAAc;AAAA,YAChD;AAAA;AAIF,eAAK,cAAc,KAAK,cAAc,UAAU,YAAU,OAAO,UAAU,SAAS,MAAM;AAAA,eACrF;AACLD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,OAAO,OAAO;AAAA,YACrB,MAAM;AAAA,UACR,CAAC;AAAA,QACH;AAAA,MACA,SAAO,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,wCAAc,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,eAAe,GAAG;AAChB,WAAK,cAAc,EAAE,OAAO;AAC5B,WAAK,SAAS,SAAS,KAAK,cAAc,KAAK,WAAW,EAAE;AAAA,IAC7D;AAAA;AAAA,IAGD,eAAe;AACb,UAAI,CAAC,KAAK,SAAS,YAAY,KAAI,GAAI;AACrCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AACD,eAAO;AAAA,MACT;AAEA,UAAI,CAAC,KAAK,SAAS,cAAc,KAAK,SAAS,cAAc,GAAG;AAC9DA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AACD,eAAO;AAAA,MACT;AAEA,aAAO;AAAA,IACR;AAAA;AAAA,IAGD,MAAM,WAAW;AACf,UAAI,CAAC,KAAK,aAAY;AAAI;AAE1BA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACT,CAAC;AAED,UAAI;AACF,cAAM,SAAS,KAAK,SAAS,eAAe;AAC5C,cAAM,OAAO,KAAK,SACd,EAAE,IAAI,KAAK,QAAQ,GAAG,KAAK,SAAS,IACpC,KAAK;AAET,cAAM,SAAS,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACzC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ;AAAA,YACA;AAAA,UACF;AAAA,QACF,CAAC;AAED,YAAI,OAAO,OAAO,SAAS,GAAG;AAC5BD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,KAAK,SAAS,SAAS;AAAA,YAC9B,MAAM;AAAA,UACR,CAAC;AAED,qBAAW,MAAM;AACfA,0BAAG,MAAC,aAAY;AAAA,UACjB,GAAE,IAAI;AAAA,eACF;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,OAAO,OAAO;AAAA,YACrB,MAAM;AAAA,UACR,CAAC;AAAA,QACH;AAAA,MACA,SAAO,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,wCAAA,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAAA,MACH,UAAU;AACRA,sBAAG,MAAC,YAAW;AAAA,MACjB;AAAA,IACD;AAAA;AAAA,IAGD,SAAS;AACPA,oBAAG,MAAC,aAAY;AAAA,IAClB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvRA,GAAG,WAAW,eAAe;"}