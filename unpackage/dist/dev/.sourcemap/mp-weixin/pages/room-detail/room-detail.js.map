{"version":3,"file":"room-detail.js","sources":["pages/room-detail/room-detail.vue","pages/room-detail/room-detail.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"room-info-card\" v-if=\"roomInfo\">\r\n      <!-- 房间基本信息 -->\r\n      <view class=\"info-section\">\r\n        <view class=\"section-title\">基本信息</view>\r\n        <view class=\"info-grid\">\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">房间号</view>\r\n            <view class=\"info-value\">{{ roomInfo.room_number }}</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">楼层</view>\r\n            <view class=\"info-value\">{{ roomInfo.floor || '--' }}层</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">面积</view>\r\n            <view class=\"info-value\">{{ roomInfo.area || '--' }}㎡</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">租金</view>\r\n            <view class=\"info-value price\">¥{{ roomInfo.rent_price }}/月</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">状态</view>\r\n            <view class=\"info-value\">\r\n              <view class=\"status-tag\" :class=\"'status-' + roomInfo.status\">\r\n                {{ getStatusText(roomInfo.status) }}\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 租户信息 -->\r\n      <view class=\"info-section\" v-if=\"roomInfo.tenant_info\">\r\n        <view class=\"section-title\">租户信息</view>\r\n        <view class=\"info-grid\">\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">姓名</view>\r\n            <view class=\"info-value\">{{ roomInfo.tenant_info.name }}</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">身份证</view>\r\n            <view class=\"info-value\">{{ roomInfo.tenant_info.id_card }}</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">电话</view>\r\n            <view class=\"info-value phone\" @click=\"callTenant\">{{ roomInfo.tenant_info.phone }}</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">租期开始</view>\r\n            <view class=\"info-value\">{{ formatDate(roomInfo.tenant_info.rent_start_date) }}</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">租期结束</view>\r\n            <view class=\"info-value\">{{ formatDate(roomInfo.tenant_info.rent_end_date) }}</view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 水电信息 -->\r\n      <view class=\"info-section\">\r\n        <view class=\"section-title\">水电信息</view>\r\n        <view class=\"info-grid\">\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">电表读数</view>\r\n            <view class=\"info-value\">{{ roomInfo.utilities?.electricity_reading || 0 }}度</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">水表读数</view>\r\n            <view class=\"info-value\">{{ roomInfo.utilities?.water_reading || 0 }}吨</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">电费单价</view>\r\n            <view class=\"info-value\">¥{{ roomInfo.utilities?.electricity_rate || 0.5 }}/度</view>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <view class=\"info-label\">水费单价</view>\r\n            <view class=\"info-value\">¥{{ roomInfo.utilities?.water_rate || 3.0 }}/吨</view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 操作按钮 -->\r\n      <view class=\"action-buttons\">\r\n        <button class=\"action-btn edit\" @click=\"editRoom\">编辑房间</button>\r\n        <button class=\"action-btn utilities\" @click=\"manageUtilities\">水电管理</button>\r\n        <button class=\"action-btn tenant\" @click=\"manageTenant\" v-if=\"roomInfo.status === 'available'\">\r\n          添加租户\r\n        </button>\r\n        <button class=\"action-btn tenant-remove\" @click=\"removeTenant\" v-if=\"roomInfo.status === 'rented'\">\r\n          移除租户\r\n        </button>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 加载状态 -->\r\n    <view class=\"loading\" v-if=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      roomInfo: null,\r\n      loading: true,\r\n      roomId: ''\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    if (options.id) {\r\n      this.roomId = options.id;\r\n      this.loadRoomInfo();\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    // 加载房间信息\r\n    async loadRoomInfo() {\r\n      this.loading = true;\r\n      \r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRoomById',\r\n            data: { id: this.roomId }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          this.roomInfo = result.result.data;\r\n          // 更新页面标题\r\n          uni.setNavigationBarTitle({\r\n            title: `${this.roomInfo.room_number}号房详情`\r\n          });\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('加载房间信息失败:', error);\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    \r\n    // 编辑房间\r\n    editRoom() {\r\n      uni.navigateTo({\r\n        url: `/pages/room-edit/room-edit?id=${this.roomId}`\r\n      });\r\n    },\r\n    \r\n    // 管理水电\r\n    manageUtilities() {\r\n      uni.navigateTo({\r\n        url: `/pages/utility-record/utility-record?roomId=${this.roomId}`\r\n      });\r\n    },\r\n    \r\n    // 管理租户\r\n    manageTenant() {\r\n      uni.navigateTo({\r\n        url: `/pages/tenant-info/tenant-info?roomId=${this.roomId}`\r\n      });\r\n    },\r\n    \r\n    // 移除租户\r\n    removeTenant() {\r\n      uni.showModal({\r\n        title: '确认操作',\r\n        content: '确定要移除当前租户吗？',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              const result = await uniCloud.callFunction({\r\n                name: 'room-management',\r\n                data: {\r\n                  action: 'removeTenant',\r\n                  data: { roomId: this.roomId }\r\n                }\r\n              });\r\n              \r\n              if (result.result.code === 0) {\r\n                uni.showToast({\r\n                  title: '移除成功',\r\n                  icon: 'success'\r\n                });\r\n                this.loadRoomInfo(); // 重新加载数据\r\n              } else {\r\n                uni.showToast({\r\n                  title: result.result.message,\r\n                  icon: 'none'\r\n                });\r\n              }\r\n            } catch (error) {\r\n              console.error('移除租户失败:', error);\r\n              uni.showToast({\r\n                title: '操作失败',\r\n                icon: 'none'\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    \r\n    // 拨打电话\r\n    callTenant() {\r\n      if (this.roomInfo.tenant_info?.phone) {\r\n        uni.makePhoneCall({\r\n          phoneNumber: this.roomInfo.tenant_info.phone\r\n        });\r\n      }\r\n    },\r\n    \r\n    // 获取状态文本\r\n    getStatusText(status) {\r\n      const statusMap = {\r\n        available: '可租用',\r\n        rented: '已租用', \r\n        maintenance: '维修中'\r\n      };\r\n      return statusMap[status] || '未知';\r\n    },\r\n    \r\n    // 格式化日期\r\n    formatDate(timestamp) {\r\n      if (!timestamp) return '--';\r\n      const date = new Date(timestamp);\r\n      return date.toLocaleDateString();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n  padding: 20rpx;\r\n}\r\n\r\n.room-info-card {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.info-section {\r\n  padding: 40rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.info-section:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.info-grid {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 30rpx 20rpx;\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.info-label {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  margin-bottom: 8rpx;\r\n}\r\n\r\n.info-value {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  word-break: break-all;\r\n}\r\n\r\n.price {\r\n  color: #ff4d4f;\r\n  font-weight: bold;\r\n}\r\n\r\n.phone {\r\n  color: #007AFF;\r\n  text-decoration: underline;\r\n}\r\n\r\n.status-tag {\r\n  display: inline-block;\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 20rpx;\r\n  font-size: 24rpx;\r\n  color: white;\r\n}\r\n\r\n.status-available {\r\n  background-color: #52c41a;\r\n}\r\n\r\n.status-rented {\r\n  background-color: #ff4d4f;\r\n}\r\n\r\n.status-maintenance {\r\n  background-color: #faad14;\r\n}\r\n\r\n.action-buttons {\r\n  padding: 40rpx;\r\n  display: flex;\r\n  gap: 20rpx;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.action-btn {\r\n  flex: 1;\r\n  min-width: 200rpx;\r\n  padding: 24rpx;\r\n  border: none;\r\n  border-radius: 12rpx;\r\n  font-size: 28rpx;\r\n  color: white;\r\n}\r\n\r\n.edit {\r\n  background-color: #1890ff;\r\n}\r\n\r\n.utilities {\r\n  background-color: #52c41a;\r\n}\r\n\r\n.tenant {\r\n  background-color: #722ed1;\r\n}\r\n\r\n.tenant-remove {\r\n  background-color: #ff4d4f;\r\n}\r\n\r\n.loading {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 400rpx;\r\n  color: #999;\r\n}\r\n</style>","import MiniProgramPage from '/Users/peakom/Documents/work/room-list/pages/room-detail/room-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":";;AAyGA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,SAAS;AAAA,MACT,QAAQ;AAAA,IACV;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AACd,QAAI,QAAQ,IAAI;AACd,WAAK,SAAS,QAAQ;AACtB,WAAK,aAAY;AAAA,IACnB;AAAA,EACD;AAAA,EAED,SAAS;AAAA;AAAA,IAEP,MAAM,eAAe;AACnB,WAAK,UAAU;AAEf,UAAI;AACF,cAAM,SAAS,MAAMA,cAAQ,GAAC,aAAa;AAAA,UACzC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,MAAM,EAAE,IAAI,KAAK,OAAO;AAAA,UAC1B;AAAA,QACF,CAAC;AAED,YAAI,OAAO,OAAO,SAAS,GAAG;AAC5B,eAAK,WAAW,OAAO,OAAO;AAE9BC,wBAAAA,MAAI,sBAAsB;AAAA,YACxB,OAAO,GAAG,KAAK,SAAS,WAAW;AAAA,UACrC,CAAC;AAAA,eACI;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,OAAO,OAAO;AAAA,YACrB,MAAM;AAAA,UACR,CAAC;AAAA,QACH;AAAA,MACA,SAAO,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,4CAAc,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAAA,MACH,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA;AAAA,IAGD,WAAW;AACTA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,iCAAiC,KAAK,MAAM;AAAA,MACnD,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,kBAAkB;AAChBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,+CAA+C,KAAK,MAAM;AAAA,MACjE,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,eAAe;AACbA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,yCAAyC,KAAK,MAAM;AAAA,MAC3D,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,eAAe;AACbA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AACf,gBAAI;AACF,oBAAM,SAAS,MAAMD,cAAQ,GAAC,aAAa;AAAA,gBACzC,MAAM;AAAA,gBACN,MAAM;AAAA,kBACJ,QAAQ;AAAA,kBACR,MAAM,EAAE,QAAQ,KAAK,OAAO;AAAA,gBAC9B;AAAA,cACF,CAAC;AAED,kBAAI,OAAO,OAAO,SAAS,GAAG;AAC5BC,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACR,CAAC;AACD,qBAAK,aAAY;AAAA,qBACZ;AACLA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO,OAAO,OAAO;AAAA,kBACrB,MAAM;AAAA,gBACR,CAAC;AAAA,cACH;AAAA,YACA,SAAO,OAAO;AACdA,6FAAc,WAAW,KAAK;AAC9BA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,cACR,CAAC;AAAA,YACH;AAAA,UACF;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,aAAa;;AACX,WAAI,UAAK,SAAS,gBAAd,mBAA2B,OAAO;AACpCA,sBAAAA,MAAI,cAAc;AAAA,UAChB,aAAa,KAAK,SAAS,YAAY;AAAA,QACzC,CAAC;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,cAAc,QAAQ;AACpB,YAAM,YAAY;AAAA,QAChB,WAAW;AAAA,QACX,QAAQ;AAAA,QACR,aAAa;AAAA;AAEf,aAAO,UAAU,MAAM,KAAK;AAAA,IAC7B;AAAA;AAAA,IAGD,WAAW,WAAW;AACpB,UAAI,CAAC;AAAW,eAAO;AACvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,KAAK;IACd;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpPA,GAAG,WAAW,eAAe;"}