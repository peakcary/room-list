{"version":3,"file":"tenant-info.js","sources":["pages/tenant-info/tenant-info.vue","pages/tenant-info/tenant-info.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <form @submit=\"saveTenant\" v-if=\"!loading\">\r\n      <!-- 租户信息表单 -->\r\n      <view class=\"form-section\">\r\n        <view class=\"section-title\">租户信息</view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">姓名 *</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model=\"formData.name\"\r\n            placeholder=\"请输入租户姓名\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">身份证号 *</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model=\"formData.id_card\"\r\n            placeholder=\"请输入身份证号\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">联系电话 *</view>\r\n          <input \r\n            class=\"form-input\"\r\n            v-model=\"formData.phone\"\r\n            type=\"number\"\r\n            placeholder=\"请输入联系电话\"\r\n          />\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">租期开始日期 *</view>\r\n          <picker \r\n            mode=\"date\" \r\n            :value=\"formData.rent_start_date\" \r\n            @change=\"onStartDateChange\"\r\n          >\r\n            <view class=\"picker-input\">\r\n              {{ formData.rent_start_date || '请选择开始日期' }}\r\n              <text class=\"arrow\">▼</text>\r\n            </view>\r\n          </picker>\r\n        </view>\r\n        \r\n        <view class=\"form-item\">\r\n          <view class=\"form-label\">租期结束日期 *</view>\r\n          <picker \r\n            mode=\"date\" \r\n            :value=\"formData.rent_end_date\" \r\n            @change=\"onEndDateChange\"\r\n          >\r\n            <view class=\"picker-input\">\r\n              {{ formData.rent_end_date || '请选择结束日期' }}\r\n              <text class=\"arrow\">▼</text>\r\n            </view>\r\n          </picker>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 房间信息显示 -->\r\n      <view class=\"form-section\" v-if=\"roomInfo\">\r\n        <view class=\"section-title\">房间信息</view>\r\n        <view class=\"room-info\">\r\n          <view class=\"info-item\">\r\n            <text class=\"info-label\">房间号:</text>\r\n            <text class=\"info-value\">{{ roomInfo.room_number }}</text>\r\n          </view>\r\n          <view class=\"info-item\">\r\n            <text class=\"info-label\">租金:</text>\r\n            <text class=\"info-value price\">¥{{ roomInfo.rent_price }}/月</text>\r\n          </view>\r\n          <view class=\"info-item\" v-if=\"roomInfo.area\">\r\n            <text class=\"info-label\">面积:</text>\r\n            <text class=\"info-value\">{{ roomInfo.area }}㎡</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 操作按钮 -->\r\n      <view class=\"form-actions\">\r\n        <button class=\"btn-cancel\" @click=\"cancel\">取消</button>\r\n        <button class=\"btn-save\" @click=\"saveTenant\">保存</button>\r\n      </view>\r\n    </form>\r\n\r\n    <!-- 加载状态 -->\r\n    <view class=\"loading\" v-if=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      roomId: '',\r\n      roomInfo: null,\r\n      formData: {\r\n        name: '',\r\n        id_card: '',\r\n        phone: '',\r\n        rent_start_date: '',\r\n        rent_end_date: ''\r\n      }\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    if (options.roomId) {\r\n      this.roomId = options.roomId;\r\n      this.loadRoomInfo();\r\n    } else {\r\n      this.loading = false;\r\n    }\r\n  },\r\n  \r\n  methods: {\r\n    // 加载房间信息\r\n    async loadRoomInfo() {\r\n      try {\r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'getRoomById',\r\n            data: { id: this.roomId }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          this.roomInfo = result.result.data;\r\n          \r\n          // 如果房间已有租户，加载租户信息进行编辑\r\n          if (this.roomInfo.tenant_info) {\r\n            this.formData = {\r\n              name: this.roomInfo.tenant_info.name || '',\r\n              id_card: this.roomInfo.tenant_info.id_card || '',\r\n              phone: this.roomInfo.tenant_info.phone || '',\r\n              rent_start_date: this.formatDateForPicker(this.roomInfo.tenant_info.rent_start_date),\r\n              rent_end_date: this.formatDateForPicker(this.roomInfo.tenant_info.rent_end_date)\r\n            };\r\n            \r\n            uni.setNavigationBarTitle({\r\n              title: '编辑租户信息'\r\n            });\r\n          } else {\r\n            uni.setNavigationBarTitle({\r\n              title: '添加租户信息'\r\n            });\r\n          }\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('加载房间信息失败:', error);\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    \r\n    // 开始日期选择\r\n    onStartDateChange(e) {\r\n      this.formData.rent_start_date = e.detail.value;\r\n    },\r\n    \r\n    // 结束日期选择\r\n    onEndDateChange(e) {\r\n      this.formData.rent_end_date = e.detail.value;\r\n    },\r\n    \r\n    // 格式化日期为picker需要的格式\r\n    formatDateForPicker(timestamp) {\r\n      if (!timestamp) return '';\r\n      const date = new Date(timestamp);\r\n      const year = date.getFullYear();\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      return `${year}-${month}-${day}`;\r\n    },\r\n    \r\n    // 表单验证\r\n    validateForm() {\r\n      if (!this.formData.name.trim()) {\r\n        uni.showToast({\r\n          title: '请输入租户姓名',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      if (!this.formData.id_card.trim()) {\r\n        uni.showToast({\r\n          title: '请输入身份证号',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      // 简单的身份证号验证\r\n      if (!/^\\d{17}[\\dXx]$/.test(this.formData.id_card)) {\r\n        uni.showToast({\r\n          title: '请输入有效的身份证号',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      if (!this.formData.phone.trim()) {\r\n        uni.showToast({\r\n          title: '请输入联系电话',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      // 简单的手机号验证\r\n      if (!/^1[3-9]\\d{9}$/.test(this.formData.phone)) {\r\n        uni.showToast({\r\n          title: '请输入有效的手机号',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      if (!this.formData.rent_start_date) {\r\n        uni.showToast({\r\n          title: '请选择租期开始日期',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      if (!this.formData.rent_end_date) {\r\n        uni.showToast({\r\n          title: '请选择租期结束日期',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      // 验证日期逻辑\r\n      if (new Date(this.formData.rent_start_date) >= new Date(this.formData.rent_end_date)) {\r\n        uni.showToast({\r\n          title: '结束日期必须晚于开始日期',\r\n          icon: 'none'\r\n        });\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    },\r\n    \r\n    // 保存租户信息\r\n    async saveTenant() {\r\n      if (!this.validateForm()) return;\r\n      \r\n      uni.showLoading({\r\n        title: '保存中...'\r\n      });\r\n      \r\n      try {\r\n        const tenantInfo = {\r\n          name: this.formData.name.trim(),\r\n          id_card: this.formData.id_card.trim(),\r\n          phone: this.formData.phone.trim(),\r\n          rent_start_date: new Date(this.formData.rent_start_date).getTime(),\r\n          rent_end_date: new Date(this.formData.rent_end_date).getTime()\r\n        };\r\n        \r\n        const result = await uniCloud.callFunction({\r\n          name: 'room-management',\r\n          data: {\r\n            action: 'updateTenant',\r\n            data: {\r\n              roomId: this.roomId,\r\n              tenantInfo\r\n            }\r\n          }\r\n        });\r\n        \r\n        if (result.result.code === 0) {\r\n          uni.showToast({\r\n            title: '保存成功',\r\n            icon: 'success'\r\n          });\r\n          \r\n          setTimeout(() => {\r\n            uni.navigateBack();\r\n          }, 1500);\r\n        } else {\r\n          uni.showToast({\r\n            title: result.result.message,\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('保存租户信息失败:', error);\r\n        uni.showToast({\r\n          title: '保存失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        uni.hideLoading();\r\n      }\r\n    },\r\n    \r\n    // 取消\r\n    cancel() {\r\n      uni.navigateBack();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n  padding: 20rpx;\r\n}\r\n\r\n.form-section {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 40rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.form-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.form-label {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  padding: 20rpx;\r\n  border: 2rpx solid #e8e8e8;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.form-input:focus {\r\n  border-color: #007AFF;\r\n}\r\n\r\n.picker-input {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx;\r\n  border: 2rpx solid #e8e8e8;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background-color: #fff;\r\n  color: #333;\r\n}\r\n\r\n.arrow {\r\n  color: #999;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.room-info {\r\n  background-color: #f8f9fa;\r\n  border-radius: 12rpx;\r\n  padding: 24rpx;\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.info-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.info-label {\r\n  color: #666;\r\n  font-size: 28rpx;\r\n  margin-right: 12rpx;\r\n}\r\n\r\n.info-value {\r\n  color: #333;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.price {\r\n  color: #ff4d4f;\r\n  font-weight: bold;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 40rpx 20rpx;\r\n}\r\n\r\n.btn-cancel, .btn-save {\r\n  flex: 1;\r\n  padding: 28rpx;\r\n  border: none;\r\n  border-radius: 12rpx;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.btn-cancel {\r\n  background-color: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.btn-save {\r\n  background-color: #007AFF;\r\n  color: white;\r\n}\r\n\r\n.loading {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 400rpx;\r\n  color: #999;\r\n}\r\n</style>","import MiniProgramPage from '/Users/peakom/Documents/work/room-list/pages/tenant-info/tenant-info.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}